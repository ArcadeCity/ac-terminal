<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/ac-style/ac-style.html">
<link rel="import" href="../bower_components/ac-input/ac-input.html">
<link rel="import" href="../bower_components/ac-button/ac-button.html">

<dom-module id="ac-password">
  <!-- Defines the element's style and local DOM -->
  <template>
    <style>
      :host {
        display: block;
      }

      .pascanvas {
      /*background-color: var(--ac-yellow);*/

      @apply(--locals-canvas);
      @apply(--base-structure);

      height: 100vh;
      @apply(--layout-vertical);
      @apply(--layout-center-center);
     }
     .enterpass {
     width: 80%;
     max-width: 500px;
     @apply(--layout-vertical);
     @apply(--layout-center-center);
    }

    .whitespace {
      height: 20px;
    }
    
    </style>

    <div class="pascanvas">
    <div class="enterpass">
      <ac-input id="pas1" color="yellow" id="inputpass" label="password" type="password" bind-value="{{password}}" center></ac-input>
      <template is="dom-if" if="{{double}}">
        <ac-input id="pas2" color="yellow" id="inputpass" label="repeat password" type="password" bind-value="{{passwordrepeat}}" center></ac-input>
      </template>
      <template is="dom-if" if="{{wrongpass}}">
        <p class="redtxt">You entered the wrong password</p>
      </template>
      <template is="dom-if" if="{{notequal}}">
        <p class="redtxt">the passwords do not match</p>
      </template>
      <div class="whitespace"></div>
      <ac-button class="loginbtn" icon="ac-arrowright" on-tap="setPass" bg="base" txtcolor="yellow"></ac-button>
    </div>
    </div>

</template>
  <!-- Creates the element's prototype and registers it -->
  <script>
    Polymer({
      is: 'ac-password',
      properties: {
        wrongpass: {
          type: Boolean,
          value: false
        },
        password: {
          type: String,
          notify: true
        },
        sessionname: {
          type: String
        },
        double: {
          type: Boolean
        }
        // unlocked: {
        //   type: Boolean,
        //   notify: true
        // }
      },

      attached: function() {
        this.$.pas1.addEventListener('bind-value-changed', function(e) {
          this.notequal = false;
        }.bind(this));
        // this.$.pas2.addEventListener('bind-value-changed', function(e) {
        //   this.notequal = false;
        // }.bind(this));
      },

      _sessionName: function(name){
        return 'ac-password-' + name;
      },

      setPass: function() {
        if (this.double){
          if (this.password !== this.passwordrepeat){
            this.notequal = true;
            return;
          }
        }
        if (this.password){
          if (this.sessionname){
            sessionStorage.setItem(_sessionName(this.sessionname), this.password);
          }
          this.fire('password-received',{password:this.password});
        }
      },

      ready: function() {
        if (this.sessionname) {
          var _password = sessionStorage.getItem(_sessionName(this.sessionname));
          if (_password) {
            this.fire('password-received', {
              password: _password
            });
          }
        }
      }
    });
  </script>
</dom-module>
