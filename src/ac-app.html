<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-localstorage/iron-localstorage.html">
<script src="../../bower_components/page/page.js"></script>
<link rel="import" href="../../bower_components/neon-animation/neon-animation.html">
<link rel="import" href="../../bower_components/ac-button/ac-button.html">

<link rel="import" href="ac-sizeview.html">
<link rel="import" href="ac-avatar.html">
<link rel="import" href="ac-balance.html">
<link rel="import" href="ac-wallet.html">
<link rel="import" href="ac-vault.html">
<link rel="import" href="ac-createwallet.html">

<dom-module id="ac-app">
  <template>
  <style>
  :host {
    display: block;
    margin: 0px;
    padding: 0px;
    --title-big: 40px;
    --title-bigheight: 46px;
    width: 100%;
    height: 100vh;
  }

  .white {
    color: white;
  }

  neon-animated-pages {
    height: 100%;
  }

  .hometotal {
    background-color: var(--ac-base);
    height: 100%;
  }

  ac-avatar {
    width: 100%;
    box-sizing: border-box;
    padding: 0px 0px 16px 10vw;
    height: 16vh;
/*      position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;*/
    background-color: var(--ac-base);
    z-index: 3;
    @apply(--layout-horizontal);
    @apply(--layout-end);
  }

  ac-balance {
    width: 100%;
    margin: 16vh 0px 3vh 0px;
    height: 27vh;
  }

  ac-createwallet {
    width: 100%;
    height: 100vh;
  }

  .games {
    width: 100%;
    @apply(--layout-vertical);
    @apply(--layout-center-center);
    box-sizing: border-box;
    padding: 0px 10vw 0px 10vw;
  }

  .games ac-button {
    margin-top: 5px;
    width: 100%;
    /*background-color: rgba(255,255,255,0.015);*/
    background-color: #251C4A;
    @apply(--base-shadow-and-inset);
  }

  .square {
    height: 80vw;
  }

  </style>

    <iron-localstorage
        id="localstorage"
        name="ac-init"
        value="{{acinit}}">
    </iron-localstorage>

    <ac-vault
      id="thevault"
      password="{{password}}"
      currentkeystore="{{keystore}}"
      currentidentity="{{identity}}">
    </ac-vault>

    <neon-animated-pages id="homepages" attr-for-selected="data-page" selected="[[selected]]" entry-animation="slide-from-right-animation" exit-animation="slide-left-animation">

      <neon-animatable data-page="init">
        <ac-createwallet on-to-home="toHome"></ac-createwallet>
      </neon-animatable>

      <neon-animatable data-page="newuser">
        <ac-newuser id="newuser" on-newuser-created="createnewuser"></ac-newuser>
      </neon-animatable>

      <neon-animatable data-page="home">
      <div class="hometotal">

        <ac-avatar
          username="{{identity.username}}"
          artwork="{{identity.avatarurl}}"
          pub="{{account}}"
          mode="big"
          on-tap="toProfile">
        </ac-avatar>

        <ac-balance
          refcur="EUR"
          on-tap="toWallet"
          arcbalance="{{arcbalance}}"
          ethbalance="{{ethbalance}}">
        </ac-balance>

        <!-- <template is="dom-if" if="{{!wallet}}"> -->
        <!-- </template> -->

        <!-- @Bennisan, this feels wrong to me > we don't have any games yet, why are we putting this here? KF -->
        <!-- <div class="games">
          <ac-button txtbtn txtcolor="red" bg="base">Ridesharing</ac-button>
          <ac-button txtbtn txtcolor="red" bg="base" disabled>ArcBnB</ac-button>
          <ac-button txtbtn txtcolor="red" bg="base" disabled>Geekangels</ac-button>
          <ac-button txtbtn txtcolor="red" bg="base" disabled>DogWalkers</ac-button>
        </div> -->

      </div>
      </neon-animatable>

      <neon-animatable data-page="profile">
        <!-- The Profile view -->
        <ac-button
          bg="base"
          icon="declinenew"
          on-tap="toHome"
          small
          id="exitbtn"
          txtcolor="turquoise">
        </ac-button>

        <ac-profile
          profiledata="{{vault.profiledata}}">
        </ac-profile>

      </neon-animatable>

      <neon-animatable data-page="wallet">

        <!-- The Wallet view -->
        <ac-button
          bg="base"
          icon="declinenew"
          on-tap="toHome"
          small
          id="exitbtn"
          txtcolor="turquoise">
        </ac-button>

        <ac-wallet
          keystore="{{keystore}}"
          arcbalance="{{arcbalance}}"
          ethbalance="{{ethbalance}}">
        </ac-wallet>

      </neon-animatable>

      <neon-animatable data-page="backup">

        <!-- The backup view -->

      </neon-animatable>

      <neon-animatable data-page="userprefs">

        <!-- The user prefs view -->

      </neon-animatable>

    </neon-animated-pages>


  </template>

  <script>
    Polymer({

      is: 'ac-app',

      createnewuser: function(e) {

        this.$.thevault.createVault(e.detail.password, function() {
          page.redirect('/home');
        });


      },

      attached: function() {

        // Setup some basic routing
        page('/', () => {
          if (this.acinit){
            page.redirect('/home');
          }else{
            page.redirect('/newuser');
          }
        });

        page('/newuser', () => {
          if (Polymer.isInstance(this.$.newuser)) {
            this.selected = 'newuser';
            return;
          }

          Polymer.Base.importHref(
            '/src/ac-newuser.html', () => {
              this.selected = 'newuser';
            }, () => {
              console.log('Something failed!');
            }, true
          );
        });

        page('/home', () => {
          // if (Polymer.isInstance(this.$.activity)) {
            if (!this.$.thevault.keystore){
              page.redirect('/newuser'); 
            }else{
              this.selected = 'home';
            }
            // return;
          // }

          // Polymer.Base.importHref(
          //   '/src/ac-home.html', () => {
          //     this.selected = 'home';
          //   }, () => {
          //     console.log('Something failed!');
          //   }, true
          // );
        });

        page({
          hashbang: true
        });

      },

      toWallet: function() {
        page.redirect('/wallet');
      },

    });
  </script>

</dom-module>
