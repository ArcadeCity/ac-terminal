<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-localstorage/iron-localstorage.html">
<!-- <script src="../bower_components/page/page.js"></script> -->
<link rel="import" href="../bower_components/neon-animation/neon-animation.html">
<link rel="import" href="../bower_components/ac-button/ac-button.html">

<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">

<link rel="import" href="ac-transactionlog.html">
<link rel="import" href="ac-sizeview.html">
<link rel="import" href="ac-avatar.html">
<link rel="import" href="ac-balance.html">
<link rel="import" href="ac-wallet.html">
<link rel="import" href="ac-vault.html">
<link rel="import" href="ac-config.html">
<link rel="import" href="ac-web3.html">
<link rel="import" href="ac-profile.html">
<!-- <link rel="import" href="ac-createwallet.html">
-->
<link rel="import" href="ac-tokentransfer.html">
<!-- <link rel="import" href="ac-password.html">
-->
<link rel="import" href="ac-wallet.html">
<link rel="import" href="ac-intro.html">

<dom-module id="ac-app">
  <template>
    <style>
  :host {
    display: block;
    margin: 0px;
    padding: 0px;
    width: 100%;
    height: 100vh;
    --ac-balance-width:100%;
    --ac-balance-height:30vh;
    --tokentrans-width:100%;
    --tokentrans-top:3vh;

  }

  .white {
    color: white;
  }

  neon-animated-pages {
    height: 100%;
  }

  .hometotal {
    background-color: var(--ac-base);
    height: 100%;
  }

  .homecontent {
    width: 100%;
    box-sizing: border-box;
    padding: 0px 10vw 16px 10vw;
    height: 84vh;
  }

  ac-avatar {
    width: 100%;
    box-sizing: border-box;
    padding: 0px 0px 16px 10vw;
    height: 16vh;
/*      position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;*/
    background-color: var(--ac-base);
    z-index: 3;
    @apply(--layout-horizontal);
    @apply(--layout-end);
  }

  .arcbalance {
    width: var(--ac-balance-width);
    height: var(--ac-balance-height);
  }

  .tokentrans {
    width: var(--tokentrans-width);
    margin-top: var(--tokentrans-top);
  }

  .verticcenter {
    @apply(--layout-vertical);
    @apply(--layout-center-center);
  }
  .verticstart {
    @apply(--layout-vertical);
    @apply(--layout-start);
    @apply(--layout-center-justified);
  }

  .horizontcenter {
    @apply(--layout-horizontal);
    @apply(--layout-center-center);
  }
  .horizontstart {
    @apply(--layout-horizontal);
    @apply(--layout-start);
    @apply(--layout-center-justified);
  }

  ac-createwallet {
    width: 100%;
    height: 100vh;
  }

  .games {
    width: 100%;
    @apply(--layout-vertical);
    @apply(--layout-center-center);
    box-sizing: border-box;
    padding: 0px 10vw 0px 10vw;
  }

  .games ac-button {
    margin-top: 5px;
    width: 100%;
    /*background-color: rgba(255,255,255,0.015);*/
    background-color: #251C4A;
    @apply(--base-shadow-and-inset);
  }

  .square {
    height: 80vw;
  }

  </style>

    <!-- app-location binds with the URL and produces a route for
    app-route elements to consume. Since this demo needs to run without
    server cooperation (e.g. with polyserve, in the elements catalog, etc) we'll
    use the hash portion of the URL for our route paths. -->
    <app-location route="{{route}}" use-hash-as-path></app-location>

    <!-- app-routes parse route paths based on the their `pattern`.
    Parameters are extracted into the `data` object. The rest of the path that
    comes after the `pattern` is put into the `tail` object, which can be
    passed to the `route` property of downstream app-routes. -->
    <app-route route="{{route}}" pattern="/:page" data="{{data}}" tail="{{pageTail}}"></app-route>
    <app-route route="{{route}}" pattern="/vault" tail="{{vaultTail}}"></app-route>
    <!--     <app-route route="{{route}}" pattern="/video" tail="{{videoTail}}" active="{{videoPageActive}}"></app-route>
  -->
  <ac-sizeview sizeview="{{sizeview}}"></ac-sizeview>

  <ac-config web3host="{{web3host}}"></ac-config>

  <ac-wallet id="thewallet" keystore="{{keystore}}"></ac-wallet>

  <ac-web3 host="{{web3host}}" web3="{{web3}}"></ac-web3>

  <neon-animated-pages id="homepages" attr-for-selected="data-page" selected="[[data.page]]" entry-animation="{{entryAnimation}}" exit-animation="{{exitAnimation}}">

  <neon-animatable data-page="intro">
    <ac-intro
      on-newvault="createNewVault"
      on-importfile="toimportfile"
      on-importpk="toimportpk"
      >        
    </ac-intro>
  </neon-animatable>


    <neon-animatable data-page="vault">
    <ac-vault
      id="thevault"
      route="[[pageTail]]"
      currentkeystore="{{keystore}}"
      currentidentity="{{identity}}"
      currentaccount="{{account}}"
      on-unlocked="vaultUnlocked"
      on-locked="vaultLocked"
      on-novault="noVault"
      ></ac-vault>

  </neon-animatable>

 <!--  <neon-animatable data-page="init">
    <ac-createwallet on-to-home="toHome"></ac-createwallet>
  </neon-animatable>

  <neon-animatable data-page="newuser">
    <ac-newuser id="newuser" on-newuser-created="createnewuser"></ac-newuser>
  </neon-animatable> -->

  <neon-animatable data-page="home">
    <div class="hometotal">

      <ac-avatar
          identity="{{identity}}"
          pubkey="{{account}}"
          mode="big"
          on-tap="toProfile"></ac-avatar>
      <div class="homecontent">
        <div class$="arcbalance {{arcalign}}">
          <ac-balance
          refcur="EUR"
          on-tap="toWallet"
          arcbalance="{{arcbalance}}"
          ethbalance="{{ethbalance}}"></ac-balance>
        </div>

        <div class$="tokentrans {{arcalign}}">
          <!-- <ac-tokentransfer account="{{account}}"></ac-tokentransfer> -->
        </div>

        <ac-wallet
          keystore="[[keystore]]"
          arcbalance="{{arcbalance}}"
          ethbalance="{{ethbalance}}"></ac-wallet>
      </div>

    </div>
  </neon-animatable>

  <neon-animatable data-page="profile">

    <div class="hometotal">

      <ac-profile
            id="profile"
            identity="[[identity]]"
            on-exit="toHome"
            on-identity-update="saveIdentity"></ac-profile>
    </div>

  </neon-animatable>

  <neon-animatable data-page="wallet">
    <div class="hometotal">

      <ac-button
            bg="base"
            icon="declinenew"
            on-tap="toHome"
            small
            id="exitbtn"
            txtcolor="turquoise"></ac-button>

      <ac-balance
            refcur="EUR"
            arcbalance="[[arcbalance]]"
            ethbalance="[[ethbalance]]"></ac-balance>
      <ac-wallet
            keystore="[[keystore]]"
            arcbalance="{{arcbalance}}"
            ethbalance="{{ethbalance}}"></ac-wallet>
    </div>
  </neon-animatable>
</neon-animated-pages>

</template>

<script>
    Polymer({
      is: 'ac-app',

      properties: {
        entryAnimation: {
          type: String,
          observer: 'animLogger'
        },
        exitAnimation: {
          type: String,
          observer: 'animLogger'
        },

        sizeview: {
          type: String,
          observer: '_sizeview'
        },
        arcalign: {
          type: String,
        }
      },

      observers: [
        '_onRoutePathChanged(route.path)'
      ],

      _onRoutePathChanged: function(path) {
        if (!path) {
          this.transitionto('/vault/unlock');
        }
      },

      vaultUnlocked: function(){
        this.transitionto('/home');
      },

      vaultLocked: function(){
        this.transitionto('/vault/unlock');
      },

      noVault: function(){
        this.transitionto('/intro');
      },

      createNewVault: function(){
        this.transitionto('/vault/createnew');        
      },

      toimportpk: function(){
        this.transitionto('/vault/importpk');        
      },

      toimportfile: function(){
        this.transitionto('/vault/importfile');        
      },

      transitionto: function(target){
        console.log('ac-app -> transitionTo',target);
        this.set('route.path',target);
      },

      attached: function() {
        // Setup some basic routing
        var self = this;



        


        // page('/',function(){
        //   if (this.$.thevault.hasVault()) {
        //     page.redirect('/password');
        //   } else {
        //     page.redirect('/newuser');
        //   }
        // }.bind(this));

        this.entryAnimation = 'slide-from-right-animation';
        this.exitAnimation = 'slide-left-animation';

        // page('/newuser',function(){
        //   if (Polymer.isInstance(this.$.newuser)) {
        //     this.selected = 'newuser';
        //     return;
        //   }

        //   Polymer.Base.importHref(
        //     '/src/ac-newuser.html',function(){
        //       this.selected = 'newuser';
        //     }.bind(this),function(){
        //       console.log('Something failed!');
        //     }.bind(this), true
        //   );
        // }.bind(this));

        // page('/password',function(){

        //   if (!this.$.thevault.hasVault()) {
        //     return page.redirect('/');
        //   }

        //   if (Polymer.isInstance(this.$.password)) {
        //     this.selected = 'password';
        //     return;
        //   }

        //   Polymer.Base.importHref(
        //     '/src/ac-password.html',function(){
        //       this.selected = 'password';
        //     }.bind(this),function(){
        //       console.log('Something failed!');
        //     }.bind(this), true
        //   );
        // }.bind(this));

        // page('/home',function(){
        //   if (!self.$.thevault.keystore) {
        //     page.redirect('/');
        //   } else {
        //     this.selected = 'home';
        //   }
        // }.bind(this));

        // page('/wallet',function(){
        //   this.selected = 'wallet';
        // }.bind(this));

        // page('/profile',function(){
        //   this.selected = 'profile';
        // }.bind(this));

        // page('/stage',function(){
        //   this.selected = 'stage';
        // }.bind(this));

        // page({
        //   hashbang: true
        // });

      },

      toWallet: function() {
        this.transitionto('/wallet');
      },

      toHome: function() {
        this.transitionto('/home');
      },

      toProfile: function() {
        this.entryAnimation = 'slide-from-right-animation';
        this.exitAnimation = 'slide-left-animation';
        this.$.profile.init(function(){
          this.transitionto('/profile');
        }.bind(this));
      },

      saveIdentity: function() {
        this.$.thevault.saveVault();
      },

      animLogger: function() {
        console.log('NU DAN, entry==', this.entryAnimation, ' exit==', this.exitAnimation);
      },

      _sizeview: function() {
        switch (this.sizeview) {
          case 'phone':
            this.arcalign = 'verticcenter';
            this.customStyle['--ac-balance-height'] = '30vh';
            this.customStyle['--ac-balance-width'] = '100%';
            this.customStyle['--tokentrans-width'] = '100%';
            this.customStyle['--tokentrans-top'] = '0vh';
            this.updateStyles();
            break;
          case 'desktop':
            this.arcalign = 'verticstart';
            this.customStyle['--ac-balance-height'] = '20vh';
            this.customStyle['--ac-balance-width'] = '100%';
            this.customStyle['--tokentrans-top'] = '3vh';
            this.updateStyles();
            break;
          case 'xlarge':
            this.arcalign = 'verticstart';
            this.customStyle['--ac-balance-height'] = '20vh';
            this.customStyle['--ac-balance-width'] = '100%';
            this.customStyle['--tokentrans-top'] = '4vh';

            this.updateStyles();
            break;
          default:
            console.log("!!! ** Niks");
        }
      },

    });
  </script>

</dom-module>