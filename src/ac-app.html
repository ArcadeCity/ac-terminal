<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-localstorage/iron-localstorage.html">
<script src="../../bower_components/page/page.js"></script>
<link rel="import" href="../../bower_components/neon-animation/neon-animation.html">
<link rel="import" href="../../bower_components/ac-button/ac-button.html">

<link rel="import" href="ac-sizeview.html">
<link rel="import" href="ac-avatar.html">
<link rel="import" href="ac-balance.html">
<link rel="import" href="ac-wallet.html">
<link rel="import" href="ac-vault.html">
<link rel="import" href="ac-config.html">
<link rel="import" href="ac-web3.html">
<link rel="import" href="ac-profile.html">
<link rel="import" href="ac-createwallet.html">
<link rel="import" href="ac-tokentransfer.html">
<link rel="import" href="ac-password.html">

<dom-module id="ac-app">
  <template>
  <style>
  :host {
    display: block;
    margin: 0px;
    padding: 0px;
    width: 100%;
    height: 100vh;
    --ac-balance-width:100%;
    --ac-balance-height:30vh;
    --tokentrans-width:100%;
  }

  .white {
    color: white;
  }

  neon-animated-pages {
    height: 100%;
  }

  .hometotal {
    background-color: var(--ac-base);
    height: 100%;
  }

  .homecontent {
    width: 100%;
    box-sizing: border-box;
    padding: 0px 10vw 16px 10vw;
    height: 84vh;
  }

  ac-avatar {
    width: 100%;
    box-sizing: border-box;
    padding: 0px 0px 16px 10vw;
    height: 16vh;
/*      position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;*/
    background-color: var(--ac-base);
    z-index: 3;
    @apply(--layout-horizontal);
    @apply(--layout-end);
  }

  .arcbalance {
    width: var(--ac-balance-width);
    height: var(--ac-balance-height);
  }

  .tokentrans {
    width: var(--tokentrans-width);
  }

  .verticcenter {
    @apply(--layout-vertical);
    @apply(--layout-center-center);
  }
  .verticstart {
    @apply(--layout-vertical);
    @apply(--layout-start);
    @apply(--layout-center-justified);
  }

  .horizontcenter {
    @apply(--layout-horizontal);
    @apply(--layout-center-center);
  }
  .horizontstart {
    @apply(--layout-horizontal);
    @apply(--layout-start);
    @apply(--layout-center-justified);
  }

  ac-createwallet {
    width: 100%;
    height: 100vh;
  }

  .games {
    width: 100%;
    @apply(--layout-vertical);
    @apply(--layout-center-center);
    box-sizing: border-box;
    padding: 0px 10vw 0px 10vw;
  }

  .games ac-button {
    margin-top: 5px;
    width: 100%;
    /*background-color: rgba(255,255,255,0.015);*/
    background-color: #251C4A;
    @apply(--base-shadow-and-inset);
  }

  .square {
    height: 80vw;
  }

  </style>

    <ac-sizeview sizeview="{{sizeview}}"></ac-sizeview>
    <iron-localstorage
        id="localstorage"
        name="ac-init"
        value="{{acinit}}">
    </iron-localstorage>

    <ac-config web3host="{{web3host}}"></ac-config>

    <ac-vault
      id="thevault"
      password="{{password}}"
      currentkeystore="{{keystore}}"
      currentidentity="{{identity}}"
      currentaccount="{{account}}">
    </ac-vault>

    <ac-web3 host="{{web3host}}" web3="{{web3}}"></ac-web3>

    <neon-animated-pages id="homepages" attr-for-selected="data-page" selected="[[selected]]" entry-animation="{{entryAnimation}}" exit-animation="{{exitAnimation}}">

      <neon-animatable data-page="password">
        <ac-password id="newuser" on-password-received="passwordreceived"></ac-password>
      </neon-animatable>

      <neon-animatable data-page="init">
        <ac-createwallet on-to-home="toHome"></ac-createwallet>
      </neon-animatable>

      <neon-animatable data-page="newuser">
        <ac-newuser id="newuser" on-newuser-created="createnewuser"></ac-newuser>
      </neon-animatable>

      <neon-animatable data-page="home">
      <div class="hometotal">

        <ac-avatar
          username="{{identity.username}}"
          artwork="{{identity.avatarurl}}"
          pubkey="{{account}}"
          mode="big"
          on-tap="toProfile">
        </ac-avatar>
        <div class="homecontent">
        <div class$="arcbalance {{arcalign}}">
        <ac-balance
          refcur="EUR"
          on-tap="toWallet"
          arcbalance="{{arcbalance}}"
          ethbalance="{{ethbalance}}">
        </ac-balance>
        </div>

        <div class$="tokentrans {{arcalign}}">
          <ac-tokentransfer account="{{account}}"></ac-tokentransfer>
        </div>

        <ac-wallet
          keystore="[[keystore]]"
          arcbalance="{{arcbalance}}"
          ethbalance="{{ethbalance}}">
        </ac-wallet>
        </div>

        <!-- <template is="dom-if" if="{{!wallet}}"> -->
        <!-- </template> -->

        <!-- @Bennisan, this feels wrong to me > we don't have any games yet, why are we putting this here? KF -->
        <!-- <div class="games">
          <ac-button txtbtn txtcolor="red" bg="base">Ridesharing</ac-button>
          <ac-button txtbtn txtcolor="red" bg="base" disabled>ArcBnB</ac-button>
          <ac-button txtbtn txtcolor="red" bg="base" disabled>Geekangels</ac-button>
          <ac-button txtbtn txtcolor="red" bg="base" disabled>DogWalkers</ac-button>
        </div> -->

      </div>
      </neon-animatable>

      <neon-animatable data-page="profile">

        <div class="hometotal">
          <!-- The Profile view -->
          <ac-profile
            profiledata="{{identity}}"
            on-to-home="toHome"
            on-identity-update="saveIdentity">
          </ac-profile>
        </div>

      </neon-animatable>

      <neon-animatable data-page="wallet">
        <div class="hometotal">

          <!-- The Wallet view -->
          <ac-button
            bg="base"
            icon="declinenew"
            on-tap="toHome"
            small
            id="exitbtn"
            txtcolor="turquoise">
          </ac-button>

          <ac-balance
            refcur="EUR"
            arcbalance="[[arcbalance]]"
            ethbalance="[[ethbalance]]">
          </ac-balance>

          <ac-tokentransfer></ac-tokentransfer>

          <ac-wallet
            keystore="[[keystore]]"
            arcbalance="{{arcbalance}}"
            ethbalance="{{ethbalance}}">
          </ac-wallet>

        </div>

      </neon-animatable>

      <neon-animatable data-page="backup">

        <!-- The backup view -->

      </neon-animatable>

      <neon-animatable data-page="userprefs">

        <!-- The user prefs view -->

      </neon-animatable>

    </neon-animated-pages>


  </template>

  <script>
    Polymer({
      is: 'ac-app',

      properties: {
        entryAnimation: {
          type: String,
          observer: 'animLogger'
        },
        exitAnimation: {
          type: String,
          observer: 'animLogger'
        },

        sizeview: {
          type: String,
          observer: '_sizeview'          
        },
        arcalign: {
          type: String,
        },
        },

      createnewuser: function(e) {

        this.$.thevault.createVault(e.detail.password, function() {
          page.redirect('/home');
        });


      },

      passwordreceived: function(e){
        if (!this.$.thevault.hasVault()){
          return page.redirect('/');
        }
        this.$.thevault.loadVault(e.detail.password);
        page.redirect('/home');
      },

      attached: function() {

        // Setup some basic routing
        page('/', () => {
          if (this.$.thevault.hasVault()){
            page.redirect('/password');
          }else{
            page.redirect('/newuser');
          }
        });

        this.entryAnimation = 'slide-from-right-animation';
        this.exitAnimation = 'slide-left-animation';

        page('/newuser', () => {
          if (Polymer.isInstance(this.$.newuser)) {
            this.selected = 'newuser';
            return;
          }

          Polymer.Base.importHref(
            '/src/ac-newuser.html', () => {
              this.selected = 'newuser';
            }, () => {
              console.log('Something failed!');
            }, true
          );
        });

        page('/password', () => {

          if (!this.$.thevault.hasVault()){
           return page.redirect('/');
          }

          if (Polymer.isInstance(this.$.password)) {
            this.selected = 'password';
            return;
          }

          Polymer.Base.importHref(
            '/src/ac-password.html', () => {
              this.selected = 'password';
            }, () => {
              console.log('Something failed!');
            }, true
          );
        });

        page('/home', () => {
          // if (Polymer.isInstance(this.$.activity)) {
            if (!this.$.thevault.keystore){
              page.redirect('/');
            }else{
              this.selected = 'home';
            }
            // return;
          // }

          // Polymer.Base.importHref(
          //   '/src/ac-home.html', () => {
          //     this.selected = 'home';
          //   }, () => {
          //     console.log('Something failed!');
          //   }, true
          // );
        });

        page('/wallet', () => {
          this.selected = 'wallet';
        });

        page('/profile', () => {
          this.selected = 'profile';
        // this.entryAnimation = 'slide-from-left-animation';
        // this.exitAnimation = 'slide-right-animation';
        });

        page({
          hashbang: true
        });

      },

      toWallet: function() {
        page.redirect('/wallet');
      },

      toHome: function() {
        page.redirect('/home');
        // this.entryAnimation = 'slide-from-right-animation';
        // this.exitAnimation = 'slide-left-animation';
      },

      toProfile: function() {
        this.entryAnimation = 'slide-from-right-animation';
        this.exitAnimation = 'slide-left-animation';
        page.redirect('/profile');
      },

      saveIdentity: function() {
        this.$.vault.saveVault();
      },

      animLogger: function(){
      console.log('NU DAN, entry==',this.entryAnimation,' exit==',this.exitAnimation);
    },

    _sizeview: function(){
      switch(this.sizeview) {
          case 'phone':
              this.arcalign = 'verticcenter';
              this.customStyle['--ac-balance-height'] = '30vh';
              this.customStyle['--ac-balance-width'] = '100%';
              this.customStyle['--tokentrans-width'] = '100%';
              this.updateStyles();
              break;
          case 'desktop':
              this.arcalign = 'verticstart';
              this.customStyle['--ac-balance-height'] = '20vh';
              this.customStyle['--ac-balance-width'] = '100%';
              this.updateStyles();
              break;
          case 'xlarge':
              this.arcalign = 'verticstart';
              this.customStyle['--ac-balance-height'] = '20vh';
              this.customStyle['--ac-balance-width'] = '100%';
              this.updateStyles();
              break;
          default:
          console.log("!!! ** Niks");
      }
    },

    });
  </script>

</dom-module>
