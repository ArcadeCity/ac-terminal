<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/iron-localstorage/iron-localstorage.html">
<script src="../../bower_components/page/page.js"></script>

<dom-module id="ac-app">
  <template>
    <iron-localstorage
        id="localstorage"
        name="ac-init"
        value="{{acinit}}">
    </iron-localstorage>
      
    <ac-vault
      password="{{password}}"
      currentkeystore="{{keystore}}"
      currentidentity="{{identity}}">
    </ac-vault>

    <iron-pages selected="[[selected]]" attr-for-selected="data-page">
      <section data-page="home">
        <ac-home></ac-home>
      </section>
      <section data-page="newuser">
        <ac-newuser></ac-newuser>
      </section>
    </iron-pages>

  </template>

  <script>
    Polymer({

      is: 'ac-app',


      attached: function() {

        // Setup some basic routing
        page('/', () => {
          if (this.acinit){
            page.redirect('/home');
          }else{
            page.redirect('/newuser');
          }
        });

        page('/newuser', () => {
          if (Polymer.isInstance(this.$.browse)) {
            this.selected = 'newuser';
            return;
          }

          Polymer.Base.importHref(
            '/src/ac-newuser.html', () => {
              this.selected = 'newuser';
            }, () => {
              console.log('Something failed!');
            }, true
          );
        });

        page('/home', () => {
          if (Polymer.isInstance(this.$.activity)) {
            this.selected = 'home';
            return;
          }

          Polymer.Base.importHref(
            '/src/ac-home.html', () => {
              this.selected = 'home';
            }, () => {
              console.log('Something failed!');
            }, true
          );
        });

        page({
          hashbang: true
        });

      }

    });
  </script>

</dom-module>
