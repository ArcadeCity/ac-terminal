<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">

<link rel="import" href="../bower_components/ac-style/ac-style.html">
<link rel="import" href="../bower_components/ac-button/ac-button.html">
<link rel="import" href="../bower_components/ac-icon/ac-icon.html">
<link rel="import" href="../bower_components/ac-input/ac-input.html">

<link rel="import" href="ac-sizeview.html">
<link rel="import" href="ac-avatar.html">

<dom-module id="ac-profile">
  <!-- Defines the element's style and local DOM -->
  <template>
    <style>
      :host {
        display: block;
        width: 100%;
        height: 100%;
      }

      h1 {
        @apply(--ac-font-h1);
      }

      p {
        @apply(--ac-font-body1);
      }

      .total {
        display: block;
        width: 100%;
        height: 100%;
        background-color: var(--ac-base);
        /*overflow-y: scroll;*/
      }

      .whitespace {
        width: 100%;
        height: 20px;
      }

      .profilepic {
        width: 100%;
        box-sizing: border-box;
        padding: 10vh 0px 3vh 0px;
        @apply(--layout-vertical);
        @apply(--layout-center-center);
        border-bottom: 2px dotted rgba(255,255,255,0.05);

      }

      .profilepicinner {
        @apply(--layout-vertical);
        @apply(--layout-center-justified);
        @apply(--layout-end);
      }

      .profilepicinner ac-button {
        margin-top: -20px;
      }

      .uploadbtn {

      }

      .profileusername {
        width: 100%;
        box-sizing: border-box;
        padding: 3vh 0px 3vh 0px;
        @apply(--layout-vertical);
        @apply(--layout-center-center);
        border-bottom: 2px dotted rgba(255,255,255,0.05);
      }


      .profileusername ac-input {
        width: 80%;
        max-width: 600px;
        overflow: hidden;
      }

      .profileusername p {
        color: white;
      }

      .scrollcontainer {
        width: 100%;
        background-color: var(--ac-base);
      }

      .confirmbtns {
        width: 100%;
        box-sizing: border-box;
        padding: 0px;
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
      }

      .confirmbtns ac-button {
        margin: 2px;
      }

      .confirmbtns ac-icon {
        margin-right: 4px;
      }

      .topback {
        width: 100%;
        background-color: var(--ac-base);
        box-sizing: border-box;
        padding: 5vh 0px 0px 5vw;
        opacity: 0.5;
      }
    </style>

    <div class="total">
    <div class="topback">
    <ac-icon icon="ac-arrowleft" iconcolor="yellow" on-tap="backtohome" small>back</ac-icon>
    </div>
      <div class="scrollcontainer">
      <div class="profilepic">
        <div class="profilepicinner">

        <ac-avatar
          username="{{identity.username}}"
          artwork="https://pbs.twimg.com/profile_images/2849872800/cbe52909627305c4d0ca07f5ca94edeb_400x400.png"
          pubkey="{{account}}"
          mode="imgbigonly">

        </ac-avatar>
        <ac-button icon="ac-upload" txtcolor="yellow" bg="btncolor" small>upload new picture</ac-button>
        </div>

      </div>
      <div class="profileusername">
        <ac-input color="yellow" label="username" type="input" bind-value="{{username}}" center inputvalue="{{identity.username}}"></ac-input>

        <iron-collapse id="collapse">
          <div class="confirmbtns">
            <ac-icon icon="ac-decline" iconcolor="yellow" on-tap="decline" small>decline</ac-icon>
            <ac-button icon="ac-v" txtcolor="yellow" bg="btncolor" on-tap="confirm" small>confirm</ac-button>
          </div>
        </iron-collapse>

        <div class="whitespace"></div>

      </div>
      </div>
    </div>


    </template>

    <iron-localstorage
      name="ac-profile"
      value="{{userdata}}"
      on-iron-localstorage-load-empty="initprofile"
      on-iron-localstorage-load="loadprofile">
    </iron-localstorage>

  </template>

  <script>
    Polymer({
      is: 'ac-profile',
      properties: {
        username: {
          type: String,
          observer: '_username'
        },
        identity: {
          type: Object,
          value: {
            avatar: 'blablabla',
            username: 'bennisan'
          }
        }

      },

      ready: function() {
      },

      _is: function(a, b) {
        if (b === undefined){
          b = true;
        }
        //console.log(a ,'(',typeof a,') is',b,'(',typeof b,') they are equal for ==',a == b,', they are equal for ===',a === b);
        return a === b;
      },

    _sizeview: function(){
      switch(this.sizeview) {
          case 'phone':
                this.customStyle['--avatar-size'] = '90px';
              this.updateStyles();
              break;
          case 'desktop':
                this.customStyle['--avatar-size'] = '130px';
              this.updateStyles();
              break;
          case 'xlarge':
                this.customStyle['--avatar-size'] = '130px';
              this.updateStyles();
              break;
          default:
          console.log("!!! ** Niks");
      }
    },

    decline: function(){
      console.log("I've declined!");
    },

    confirm: function(){
      console.log("I've confirmed!");
    },

    _username: function() {
      console.log(this.username);
      if(this.username != this.identity.username) {
        var collapser = document.getElementById('collapse');
        collapser.show();
      }
      if(this.username == this.identity.username) {
        var collapser = document.getElementById('collapse');
        collapser.hide();
      }
    },

    savenewUsername: function(){

      console.log("this is it", collapser);
      collapser.toggle();
    },

    backtohome: function(){
      this.fire('to-home');
    }

    });
  </script>
</dom-module>
